zoom=11, scale=2,
maptype='terrain',
color='bw'))
plot3
pb <- progress_bar$new(format = "Plotting [:bar] :current/:total (:percent) elapsed::elapsedfull", total = 55, clear = F)
pb$tick(0)
for(i in c(1:length(lonlatpoint))) {
cat(i, '\n')
for(j in c(1:length(lonlatpoint[[i]]))) {
cat(j, '\n')
for(k in c(1:length(lonlatpoint[[i]][[j]])/2)) {
cat(k, '\n')
plot3 + geom_point(x=lonlatpoint[[i]][[j]][k,1], y=lonlatpoint[[i]][[j]][k,2], size = 0.5)
}
}
pb$tick(1)
}
dbDisconnectAll()
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
source(file='script/functions/functions.R')
source('database/getDB.R')
### Main
# OCC_DATE, OCC_TIME, REP_DATE, SUB_CATE, PRI_DESC, PRECINCT, SECTOR, BEAT, NEIGHBOR
col <- c('SUB_CATE')
### dataset
crimeCat <- getColumns(col)
crimeCat <- subset(crimeCat, crimeCat$SUB_CATE != '')
head(crimeCat)
group <- unique(crimeCat$SUB_CATE)
df_group <- data.frame(Category = group, Index = c(1:length(group)))
df_group
mapCrime <- read.csv('dataset/Crime/group_crime.csv', header = T, stringsAsFactors = F)
for(i in c(1:ncol(mapCrime))) {
mapCrime[,i] <- ifelse(is.na(mapCrime[,i]), 0, mapCrime[,i])
}
df_group$Category <- as.character(levels(unlist(df_group$Category)))[unlist(df_group$Category)]
crimeCat$Crime.SubcategoryIndex <- factor(crimeCat$SUB_CATE,
levels=df_group$Category, labels=df_group$Index)
crimeCat$Category <-
ifelse(crimeCat[,2] %in% mapCrime[,2], 'Murder',
ifelse(crimeCat[,2] %in% mapCrime[,3], 'Rape',
ifelse(crimeCat[,2] %in% mapCrime[,4], 'Robbery',
ifelse(crimeCat[,2] %in% mapCrime[,5], 'Aggravated',
ifelse(crimeCat[,2] %in% mapCrime[,6], 'Burglary',
ifelse(crimeCat[,2] %in% mapCrime[,7], 'LarcenyTheft',
ifelse(crimeCat[,2] %in% mapCrime[,8], 'VehicleTheft', 'Arson')))))))
crimeCat <- crimeCat[,-2]
violent <- c('Murder', 'Rape', 'Robbery', 'Aggravated')
crimeCat$Violent <- ifelse(crimeCat[,2] %in% violent, T, F)
vioTable <- table(crimeCat$Violent)
## True : Violent, False : Property
# FALSE   TRUE
# 426579  96750
v_table <- data.frame(c(vioTable))
tot <- sum(v_table[,1])
per_table <- rbind(round(v_table[2,1]/tot, 4) * 100, round(v_table[1,1]/tot, 4) * 100)
per_table <- cbind(Percent = per_table, Violent = c('Property', 'Violent'))
colnames(per_table) <- c('Percent', 'Type')
per_table <- as.data.frame(per_table)
per_table$Percent <- as.numeric(as.character.factor(per_table$Percent))
ggplot(data = per_table[order(per_table$Percent, decreasing = T),], aes(x = "", y = Percent, fill = Type)) + geom_bar(stat = 'identity') + coord_polar(theta = 'y', start = 0) + geom_text(aes(label = paste(Percent,'%')), position = position_stack(vjust = 0.5)) + labs(x = "", y = "", title = "Proportion of Crime Type during the Last 10 years") + theme_minimal()
####################################################################################################
##### Library
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
library(jsonlite)
library(progress)
library(plotly)
library(car)
####################################################################################################
##### Import
source("script/functions/functions.R")
source("database/getDB.R")
####################################################################################################
##### Main
cdf <- getColumns("SUB_CATE")
# Finding the Frequency of each crime category
crimeF <- table(cdf$SUB_CATE)
#                     Var1   Freq
# 9              CAR PROWL 148123
# 26       THEFT-ALL OTHER  54239
# 29        THEFT-SHOPLIFT  48623
# 7   BURGLARY-RESIDENTIAL  46776
# 17   MOTOR VEHICLE THEFT  43483
crimeF <- as.data.frame(crimeF)
crimeF <- crimeF[order(crimeF$Freq, decreasing=T),]
crimeF <- crimeF[c(1:5),]
# Plotting TOP 5 Crime Frequency
crimePlot1 <- ggplot() +
geom_col(aes(Var1, Freq, fill=Var1), crimeF, position="stack", show.legend=F) +
labs(x="Crime Subcategory", y="Frequency", title="TOP 5 Frequecy of Crime by Frequency between 2008 and 2018") +
theme(axis.line=element_line(color="Black", size=1, linetype="solid"))
crimePlot1
# OCC_DATE, OCC_TIME, REP_DATE, REP_TIME, SUB_CATE, PRI_DESC, PRECINCT, SECTOR, BEAT, NEIGHBOR
col <- c("OCC_TIME", "SUB_CATE", "BEAT")
crimeData <- getColumns(col)
### Get Json File - Beat Area
map <- fromJSON("database/seattle_beat.json")
BeatDF <- map$features$attributes[,c(2,5)]
beatJSON <- unique(map$features$attributes$beat)
beatCrime <- unique(crimeData$BEAT)
beats <- intersect(beatJSON, beatCrime)
### Extract Rows from Data Frame
crime_beat <- crimeData %>% subset(BEAT %in% beats)
##################################################
##### 3D Plot category, time, sector, frequency
### Categorize OCC_TIME and REP_TIME
plot3dDF <- crime_beat[c("OCC_TIME", "SUB_CATE", "BEAT")]
### Group Beats to Sectors
plot3dDF$SECTOR <- substr(plot3dDF$BEAT, 1, 1)
### Subset "Car Prowl" category as it has the largest amount of crime frequency
plot3dDF <- subset(plot3dDF, SUB_CATE != "")
### Rearrange data frame and count occurances
plot3dData <- plot3dDF[c("OCC_TIME", "SUB_CATE", "SECTOR")]
catData <- as.data.frame(rename(count(plot3dData, OCC_TIME, SUB_CATE, SECTOR), FREQ=n))
### Only treat data if frequency is higher than 10
catData <- catData %>% subset(FREQ > 50)
### Changing columns data into integers for plotting
catData$SUB_CATE <- as.factor(catData$SUB_CATE)
catData$SECTOR <- as.factor(catData$SECTOR)
### 3D Scatter Plot with Color Scaling
plot1 <- plot_ly(catData, x=~OCC_TIME, y=~SUB_CATE, z=~SECTOR,
marker=list(color=~FREQ, colorscale=c("#FFE1A1", "#683531"), showscale=T)) %>%
add_markers() %>%
layout(scene=list(xaxis=list(title="Occured Time"),
yaxis=list(title="SUB_CATE"),
zaxis=list(title="SECTOR")),
annotations=list(
x=1.13, y=1.05,
text="Frequency of Crime",
xref="paper", yref="paper",
showarrow=F
))
plot1
# Sectors B, D, Q, U, J, W have very large frequencies of Car Prowl
##################################################
##### Crime by Beat visualisation
### Graph of Crime Frequency by Sectors
freqDF <- crime_beat[c("OCC_TIME", "SUB_CATE", "BEAT")]
freqDF$SECTOR <- substr(freqDF$BEAT, 1, 1)
freqDF <- subset(freqDF, SUB_CATE != "")
### barplot data
freqDF <- as.data.frame(table(freqDF$SECTOR))
colnames(freqDF) <- c("Sector", "Frequency")
### barplot drawing
plot2 <- ggplot(data=freqDF, mapping=aes(x=Sector, y=Frequency)) +
geom_bar(aes(color=Sector, fill=Sector), stat="identity", show.legend=F) +
theme(axis.line = element_line(colour = "black", size = 1, linetype = "solid"))
plot2
dbDisconnectAll()
source('database/getDB.R')
# Probability Function
## param : year
## param : Crime Type(T : Total, Pb : Prob, V : Violent, Pp : Property)
getTop10City <- function(year_vec, type) {
pb <- progress_bar$new(format = "Inserting [:bar] :current/:total (:percent) elapsed::elapsedfull", total = length(year_vec), clear = F)
for(i in year_vec) {
data01 <- getFBIData(i)
data01$Total <- data01$VIOLENT_CRIME + data01$PROPERTY_CRIME
data01$Prob <- round(data01$Total / data01$POPULATION, 4) * 100
if(type == 'T') {
data01$Target <- data01$Total
y_label <- 'Total Frequency'
plot_main <- paste("Top 20 ", i, " Total Crimes Frequency in WA", sep = '')
}
else if(type == 'Pb') {
data01$Target <- data01$Prob
y_label <- 'Ratio'
plot_main <- paste("Top 20 ", i, " Crimes compared to total population in WA", sep = '')
}
else if(type == 'V') {
data01$Target <- round(data01$VIOLENT_CRIME / data01$Total, 4) * 100
y_label <- 'Violent Crimes Ratio'
plot_main <- paste("Top 20 ", i, " Violent Crimes Ratio in WA", sep = '')
}
else if(type == 'Pp') {
data01$Target <- round(data01$PROPERTY_CRIME / data01$Total, 4) * 100
y_label <- 'Property Crimes Ratio'
plot_main <- paste("Top 20 ", i, " Property Crimes Ratio in WA", sep = '')
}
top10 <- data01 %>% arrange(desc(data01$Target)) %>% head(20)
plot1 <-
ggplot(data = top10,
aes(x = CITY, y = Target, fill = factor(ifelse(
CITY == 'Seattle', 'Normal', 'Highlighted')))) +
geom_bar(position = 'dodge', stat = 'identity') +
labs(x = "City", y = y_label, title = plot_main, color='YEAR') +
theme_minimal(base_family = 'D2Coding') +
scale_x_discrete(limit = top10$CITY) +
scale_fill_manual(name = 'CITY', values = c('grey50', 'red')) +
theme(legend.position = 'none')
print(plot1)
pb$tick()
}
}
### Main
setYear <- c(2008:2018)
# Crime Type(T : Total, Pb : Prob, V : Violent, Pp : Property)
getTop10City(setYear, 'T')
# getTop10City(setYear, 'Pb')
# getTop10City(setYear, 'V')
# getTop10City(setYear, 'Pp')
####################################################################################################
# Library Import
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
library(stringr)
source('script/functions/functions.R')
source('database/getDB.R')
# OCC_DATE, OCC_TIME, REP_DATE, SUB_CATE, PRI_DESC, PRECINCT, SECTOR, BEAT, NEIGHBOR
### dataset
df <- getColumns('*')
head(df)
####################################################################################################
### Main
df_combined <- cutMonthYear(df)
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
graph01 <- ggplot(df_changed, aes(x = occMonth, y = Freq)) +
geom_line(aes(color = occYear, group = occYear))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
df_changed
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
df_combined <- cutMonthYear(df)
df_combined
df
####################################################################################################
### Main
df <- df[-1]
df_combined <- cutMonthYear(df)
df_combined
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
df
####################################################################################################
### Main
df <- df[,c(-1, 3:ncol(df))]
####################################################################################################
### Main
df <- df[,-c(3:ncol(df))]
### dataset
df <- getColumns('*')
head(df)
####################################################################################################
### Main
df <- df[,-c(3:ncol(df))]
df <- df[-1]
df_combined <- cutMonthYear(df)
df_combined
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
graph01 <- ggplot(df_changed, aes(x = occMonth, y = Freq)) +
geom_line(aes(color = occYear, group = occYear))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
### calculating average values & adding a new column
mx_table <- as.matrix(table(df_combined[,-1]))
ncol(mx_table)
average <- c()
for(i in c(1:12)) {
average <- c(average, round(mean(as.numeric(mx_table[,i])), 0))
}
avg <- as.data.frame(average)
avg <- cbind(avg, month = unique(df_combined$occMonth))
### adding a new line on graph01
graph02 <- graph01 +
geom_line(aes(x = month, y = average, group=1), data=avg, linetype='longdash', size = 1, inherit.aes = FALSE)
df_combined
avg
unique(df_combined$occMonth)
df_combined
df_changed
graph01 <- ggplot(df_changed, aes(x = month, y = Freq)) +
geom_line(aes(color = occYear, group = occYear))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
graph01
graph01 <- ggplot(df_changed, aes(x = month, y = Freq)) +
geom_line(aes(color = year, group = year))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
graph01
####################################################################################################
# Library Import
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
library(stringr)
source('script/functions/functions.R')
source('database/getDB.R')
# OCC_DATE, OCC_TIME, REP_DATE, SUB_CATE, PRI_DESC, PRECINCT, SECTOR, BEAT, NEIGHBOR
### dataset
df <- getColumns('*')
head(df)
####################################################################################################
### Main
df <- df[,-c(3:ncol(df))]
df <- df[-1]
df_combined <- cutMonthYear(df)
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
graph01 <- ggplot(df_changed, aes(x = month, y = Freq)) +
geom_line(aes(color = year, group = year))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
### calculating average values & adding a new column
mx_table <- as.matrix(table(df_combined[,-1]))
ncol(mx_table)
average <- c()
for(i in c(1:12)) {
average <- c(average, round(mean(as.numeric(mx_table[,i])), 0))
}
avg <- as.data.frame(average)
avg <- cbind(avg, month = unique(df_combined$month))
### adding a new line on graph01
graph02 <- graph01 +
geom_line(aes(x = month, y = average, group=1), data=avg, linetype='longdash', size = 1, inherit.aes = FALSE)
graph02
####################################################################################################
# Library Import
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
library(stringr)
source('script/functions/functions.R')
source('database/getDB.R')
### dataset
df <- getColumns('*')
source('database/getDB.R')
### dataset
df <- getColumns('*')
head(df)
source('database/getDB.R')
### dataset
df <- getColumns('*')
source('database/getDB.R')
### dataset
df <- getColumns('*')
head(df)
####################################################################################################
### Main
df <- df[,-c(3:ncol(df))]
df <- df[-1]
df_combined <- cutMonthYear(df)
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
graph01 <- ggplot(df_changed, aes(x = month, y = Freq)) +
geom_line(aes(color = year, group = year))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
### calculating average values & adding a new column
mx_table <- as.matrix(table(df_combined[,-1]))
ncol(mx_table)
average <- c()
for(i in c(1:12)) {
average <- c(average, round(mean(as.numeric(mx_table[,i])), 0))
}
avg <- as.data.frame(average)
avg <- cbind(avg, month = unique(df_combined$month))
### adding a new line on graph01
graph02 <- graph01 +
geom_line(aes(x = month, y = average, group=1), data=avg, linetype='longdash', size = 1, inherit.aes = FALSE)
graph02
####################################################################################################
# Library Import
library(dplyr)
library(ggplot2)
library(ggdark)
library(reshape2)
library(stringr)
source('script/functions/functions.R')
source('database/getDB.R')
# OCC_DATE, OCC_TIME, REP_DATE, SUB_CATE, PRI_DESC, PRECINCT, SECTOR, BEAT, NEIGHBOR
### dataset
df <- getColumns('*')
head(df)
### dataset
df <- getColumns('OCC_DATE')
### dataset
df <- getColumns('OCC_DATE')
df
df_combined <- cutMonthYear(df)
df_combined
### dataset
df <- getColumns('OCC_DATE')
head(df)
####################################################################################################
### Main
df_combined <- cutMonthYear(df)
### making a line graph
df_changed <- as.data.frame(table(df_combined[,-1]))
df_changed
graph01 <- ggplot(df_changed, aes(x = month, y = Freq)) +
geom_line(aes(color = year, group = year))  +
labs(x = "Month", y = "Frequency", title = "The Number of Monthly Crime Occurrences per Each Year", color='Year') + dark_theme_grey()
graph01
### calculating average values & adding a new column
mx_table <- as.matrix(table(df_combined[,-1]))
ncol(mx_table)
average <- c()
for(i in c(1:12)) {
average <- c(average, round(mean(as.numeric(mx_table[,i])), 0))
}
avg <- as.data.frame(average)
avg <- cbind(avg, month = unique(df_combined$month))
### adding a new line on graph01
graph02 <- graph01 +
geom_line(aes(x = month, y = average, group=1), data=avg, linetype='longdash', size = 1, inherit.aes = FALSE)
graph02
####################################################################################################
### Import
source("script/functions/functions.R")
source("script/functions/mlfunctions.R")
source("database/getDB.R")
####################################################################################################
### Importing Data
# Get required Columns
reqCol <- c("OCC_DATE", "REP_DATE","REP_TIME","SUB_CATE","PRI_DESC", "BEAT", "NEIGHBOR")
# get DB
cdf <- getColumns(reqCol)
# add Year and Month col
cdf <- cutMonthYear(cdf)
str(cdf)
# Finding the Frequency of each crime category
crimeF <- table(cdf$SUB_CATE)
crimeF <- as.data.frame(crimeF)
crimeF <- crimeF[order(crimeF$Freq, decreasing=T),]
# Plotting Crime Frequency
crimePlot1 <- ggplot() +
geom_col(aes(Var1, Freq, fill=Var1), crimeF, position="stack", show.legend=F) +
labs(x="Crime Subcategory", y="Frequency", title="Frequecy of Crime by Frequency between 2008 and 2018") +
theme(axis.line=element_line(color="Black", size=1, linetype="solid")) +
scale_x_discrete(labels=c(1:nrow(crimeF)))
# crimePlot1
##################################################
### Car Prowl Prediction
# Data Extraction
cpData <- subset(cdf, SUB_CATE == "CAR PROWL")
nrow(cpData) # 144,327
# Find the Frequency of Crime Neighborhood
neighF <- table(cpData$NEIGHBOR)
neighF <- as.data.frame(neighF)
neighF <- neighF[order(neighF$Freq, decreasing=T),]
# Plotting Frequency of Crime Neighborhood of Car Prowl subcategory
neighPlot1 <- ggplot() +
geom_col(aes(Var1, Freq, fill=Var1), neighF, position="stack", show.legend=F) +
labs(x="Crime Neighborhood", y="Frequency", title="Frequency of Crime by Neighborhood between 2008 and 2018") +
theme(axis.line=element_line(color="Black", size=1, linetype="solid")) +
scale_x_discrete(labels=c(1:nrow(neighF)))
# neighPlot1
# Adding a y = 4000 line to the previous graph
neighPlot2 <- neighPlot1 + geom_hline(aes(yintercept=4000), color="Black", size=2) +
annotate(geom="text", x=30, y=4300, label="Frequency = 4000", color="Black", size=5)
# neighPlot2
# Subsetting Neighborhoods(15, 46, 52, 42, 8, 49, 5, 57, 4) from cpData
neighF <- subset(neighF, Freq >= 4000)
neighborhoods <- c("DOWNTOWN COMMERCIAL", "QUEEN ANNE", "SLU/CASCADE", "NORTHGATE", "CAPITOL HILL", "ROOSEVELT/RAVENNA", "BELLTOWN", "UNIVERSITY", "BALLARD SOUTH")
neData <- subset(cpData, NEIGHBOR %in% neighborhoods)
# Remove "Occurred.Date" column
neData <- neData[,-1]
colnames(neData) <- c("oYear","oMonth","rDate","rTime","Subcategory","Description","Beat","Neighborhood")
# Divide "Reported.Date" column into Year and Month
rYM <- dateToYM(neData["rDate"], "rYear", "rMonth")
neData <- cbind(neData, rYM)
# Divide "Reported.Time" column into Hour and Minute
neData <- na.omit(neData)
rTimeInt <- neData$rTime
rTimeChar <- as.character(rTimeInt)
for(i in c(1:length(rTimeChar))) { # Making all elements length of 4
if(nchar(rTimeChar[i]) == 3) {
rTimeChar[i] <- paste("0", rTimeChar[i], sep="")
} else if(nchar(rTimeChar[i]) == 2) {
rTimeChar[i] <- paste("00", rTimeChar[i], sep="")
} else if(rTimeChar[i] == 0) {
rTimeChar[i] <- "0000"
} else if(nchar(rTimeChar[i]) == 1) {
rTimeChar[i] <- paste("000", rTimeChar[i], sep="")
}
}
rHour <- substr(rTimeChar, 1, 2)
rMin <- substr(rTimeChar, 3, 4)
neData <- cbind(neData, rHour, rMin)
# Remove Factors
factors <- c("oMonth","rMonth","rHour")
for(f in factors) {
neData[f] <- as.numeric(as.character(unlist(neData[f])))
}
# Reorder Data Frame and remove unnecessary columns
neData <- neData[c("oMonth","rMonth","rHour","Beat")]
##############################
### nnet package
# One-Hot Encoding
beat.ind <- class.ind(neData$Beat)
neData <- cbind(neData, beat.ind)
# Training and Testing Data
idx <- sample(c(1:nrow(neData)), 0.8*nrow(neData))
trainData <- neData[idx,]
testData <- neData[-idx,]
trainX <- trainData[,c(1:3)]; trainY <- trainData[,c(5:30)];
testX <- testData[,c(1:3)];
# Data Normalisation
trainX <- as.data.frame(lapply(trainX, normalize))
testX <- as.data.frame(lapply(testX, normalize))
# Create Model
# nnModel <- nnet(x=trainX, y=trainY, decay=5e-04, maxit=100, MaxNWts=2000, trace=T, size=c(30,30), softmax=T)
nnModel <- nnet(x = trainX, y = trainY, size = 10, maxit = 100, softmax = T)
plot.nnet(nnModel)
